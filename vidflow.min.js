class VidflowEmbed extends HTMLElement{connectedCallback(){this.videoId=this.getAttribute("videoid"),this.thumbnail=this.getAttribute("thumbnail"),this.isMobile=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);const t=`<div vidflow-el="overlay" title="Play/Pause"><img vidflow-el="thumbnail" src="${this.thumbnail}" alt="" loading="lazy" /><button vidflow-el="start" aria-label="Play/Pause" style="border: none; opacity: 0;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 163.861 163.861" xml:space="preserve" width="100%" height="100%" style="width: 36px; height: 36px;"><path d="M34.857 3.613C20.084-4.861 8.107 2.081 8.107 19.106v125.637c0 17.042 11.977 23.975 26.75 15.509L144.67 97.275c14.778-8.477 14.778-22.211 0-30.686L34.857 3.613z" fill="currentColor" /></svg></button></div>`;this.overlay=document.createElement("div"),this.overlay.innerHTML=t,this.append(this.overlay),this.overlay.querySelector('[vidflow-el="overlay"]').addEventListener("click",()=>{if(!this.player||!this.player.playVideo)return;this.player.getPlayerState()===YT.PlayerState.PLAYING?this.player.pauseVideo():this.player.playVideo()}),setTimeout(VidflowEmbed.warmConnections,500),this.addEventListener("click",this.activate),this.isMobile&&setTimeout(this.activate.bind(this),250),this.needsYTApi=!0}static addPrefetch(t,i,e){const a=document.createElement("link");a.rel=t,a.href=i,e&&(a.as=e),document.head.append(a)}static warmConnections(){VidflowEmbed.preconnected||(VidflowEmbed.addPrefetch("preconnect","https://www.youtube-nocookie.com"),VidflowEmbed.addPrefetch("preconnect","https://www.google.com"),VidflowEmbed.addPrefetch("preconnect","https://googleads.g.doubleclick.net"),VidflowEmbed.addPrefetch("preconnect","https://static.doubleclick.net"),VidflowEmbed.preconnected=!0)}fetchYTPlayerApi(){window.YT||window.YT&&window.YT.Player||(this.ytApiPromise=new Promise((t,i)=>{var e=document.createElement("script");e.src="https://www.youtube.com/iframe_api",e.async=!0,e.onload=a=>{YT.ready(t)},e.onerror=i,this.append(e)}))}async getYTPlayer(){return this.playerPromise||await this.activate(),this.playerPromise}async addYTPlayerIframe(){this.fetchYTPlayerApi(),await this.ytApiPromise;const t=document.createElement("div"),i='<div vidflow-el="instance-crop"><div vidflow-el="player-wrap"><div vidflow-el="player-crop"></div></div></div>';t.innerHTML=i,this.append(t);const e=Object.fromEntries(this.getParams().entries());this.playerPromise=new Promise(a=>{const l=t.querySelector('[vidflow-el="player-crop"]');let s=new YT.Player(l,{width:349058,height:1080,videoId:this.videoId,playerVars:e,events:{onReady:r=>{r.target.setPlaybackQuality("highres"),r.target.playVideo(),this.isMobile||this.showHideThumbnail(!1),a(s)},onStateChange:r=>{r.data===YT.PlayerState.BUFFERING&&r.target.setPlaybackQuality("highres"),r.data===YT.PlayerState.PLAYING?this.showHideThumbnail(!1):r.data===YT.PlayerState.ENDED&&this.showHideThumbnail(!0)}}});this.player=s})}showHideThumbnail(t){this.querySelector('[vidflow-el="thumbnail"]').style.display=t?"flex":"none",this.querySelector('[vidflow-el="start"]').style.display=t?"flex":"none"}getParams(){const t=new URLSearchParams(this.getAttribute("params")||[]);return t.append("autoplay","1"),t.append("playsinline","1"),t.append("controls",0),t.append("rel",0),t.append("showinfo",0),t.append("modestbranding",1),t.append("ecver",2),t.append("vq","hd1080"),t}async activate(){if(!this.classList.contains("is-activated")&&(this.classList.add("is-activated"),this.needsYTApi))return this.addYTPlayerIframe(this.getParams())}}customElements.define("vidflow-player",VidflowEmbed),function(){if(["127.0.0.1","localhost"].includes(window.location.hostname)){console.warn("Test mode");const e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("href","http://127.0.0.1:5501/src/vidflow.css"),document.head.appendChild(e)}else{const e=document.createElement("style");e.innerHTML=":root{--vidflow-accent: white;--vidflow-bezier: cubic-bezier(.76, 0, .24, 1);--vidflow-border-radius: .5rem;--vidflow-btn-size: 1rem;--vidflow-controls-bg: rgba(50, 50, 50, .6);--vidflow-font-family: sans-serif}vidflow-player{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;background-color:#000;position:relative;display:block;contain:content;cursor:pointer;border-radius:var(--vidflow-border-radius);overflow:hidden;aspect-ratio:16/9;font-family:var(--vidflow-font-family)}vidflow-player.is-activated:before,vidflow-player.is-activated>.btn-play{opacity:0;pointer-events:none}[vidflow-el=player-crop]:before{display:block;padding-top:56.25%;content:'\'}[vidflow-el=player-crop]{position:relative;width:100%}[vidflow-el=player-crop] iframe{position:absolute;top:0;left:-1%;width:102%;height:100%}[vidflow-el=instance] button{background-color:#0000;appearance:none;border:none;transition:transform .3s var(--vidflow-bezier),opacity .3s var(--vidflow-bezier);cursor:pointer;padding:0;color:var(--vidflow-accent)}[vidflow-el=instance-crop]{overflow:hidden;margin-top:-51.4%;margin-bottom:-20.7%}[vidflow-el=player-wrap]{position:relative;overflow:hidden;padding-top:128.25%}[vidflow-el=player-wrap] [vidflow-el=player-crop]{position:absolute;top:0;left:0;width:100%;height:124%}[vidflow-el=overlay],[vidflow-el=thumbnail]{width:100%;height:100%;position:absolute;top:0;left:0;object-fit:cover;object-position:center}[vidflow-el=overlay]{z-index:2;display:flex;align-items:center;justify-content:center}[vidflow-el=instance] button[vidflow-el=start]{height:calc(var(--vidflow-btn-size) * 5);width:calc(var(--vidflow-btn-size) * 5);-webkit-backdrop-filter:blur(13px);display:flex;align-items:center;background-color:var(--vidflow-controls-bg);backdrop-filter:blur(13px);border-radius:50%;justify-content:center;padding-left:.4rem;transition:opacity .3s var(--vidflow-bezier),height .3s var(--vidflow-bezier),width .3s var(--vidflow-bezier)}[vidflow-el=instance][vidflow-state=loading] button[vidflow-el=start]{opacity:1!important}[vidflow-el=unmute]{height:100%;width:100%;position:absolute;right:0;bottom:0;z-index:10;background:#0006;transition:opacity .3s var(--vidflow-bezier),visibility .3s var(--vidflow-bezier);display:flex;align-items:center;justify-content:center}@media (min-width: 1024px){:root{--vidflow-border-radius: 1rem;--vidflow-btn-size: 1.25rem}}",document.head.appendChild(e)}function t(e){return e=e.split(/(vi\/|v=|\/v\/|youtu\.be\/|\/embed\/)/),e[2]!==void 0?e[2].split(/[^0-9a-z_\-]/i)[0]:e[0]}const i=document.querySelectorAll("[vidflow-el=player]");if(!i.length)throw new Error("No vidflow elements found.");i.forEach((e,a)=>{const l=e.getAttribute("vidflow-video"),s=e.nodeName==="IFRAME"?e:e.querySelector("iframe"),r=s?s.getAttribute("src"):l,o=t(r);let d=`https://i.ytimg.com/vi/${o}/hqdefault.jpg`;e.getAttribute("vidflow-thumbnail")&&(d=e.getAttribute("vidflow-thumbnail"));var n=document.createElement("div");n.setAttribute("vidflow-el","instance"),n.setAttribute("vidflow-state","loading"),e.parentNode.insertBefore(n,e),s&&n.appendChild(s),n.innerHTML=`<vidflow-player style="aspect-ratio: 16/9;" videoid="${o}" thumbnail="${d}"></vidflow-player>`,e.parentNode&&e.parentNode.removeChild(e)})}();
