class VidflowEmbed extends HTMLElement{connectedCallback(){this.videoId=this.getAttribute("videoid"),this.thumbnail=this.getAttribute("thumbnail"),this.isMobile=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);const t=`<div vidflow-el="overlay" title="Play/Pause"><img vidflow-el="thumbnail" src="${this.thumbnail}" alt="" loading="lazy" /><button vidflow-el="start" aria-label="Play/Pause" style="border: none; opacity: 0;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 163.861 163.861" xml:space="preserve" width="100%" height="100%" style="width: 36px; height: 36px;"><path d="M34.857 3.613C20.084-4.861 8.107 2.081 8.107 19.106v125.637c0 17.042 11.977 23.975 26.75 15.509L144.67 97.275c14.778-8.477 14.778-22.211 0-30.686L34.857 3.613z" fill="currentColor" /></svg></button></div>`;this.overlay=document.createElement("div"),this.overlay.innerHTML=t,this.append(this.overlay),this.overlay.querySelector('[vidflow-el="overlay"]').addEventListener("click",()=>{if(!this.player||!this.player.playVideo)return;this.player.getPlayerState()===YT.PlayerState.PLAYING?this.player.pauseVideo():this.player.playVideo()}),setTimeout(VidflowEmbed.warmConnections,500),this.addEventListener("click",this.activate),this.isMobile&&setTimeout(this.activate.bind(this),250),this.needsYTApi=!0}static addPrefetch(t,i,e){const a=document.createElement("link");a.rel=t,a.href=i,e&&(a.as=e),document.head.append(a)}static warmConnections(){VidflowEmbed.preconnected||(VidflowEmbed.addPrefetch("preconnect","https://www.youtube-nocookie.com"),VidflowEmbed.addPrefetch("preconnect","https://www.google.com"),VidflowEmbed.addPrefetch("preconnect","https://googleads.g.doubleclick.net"),VidflowEmbed.addPrefetch("preconnect","https://static.doubleclick.net"),VidflowEmbed.preconnected=!0)}fetchYTPlayerApi(){window.YT||window.YT&&window.YT.Player||(this.ytApiPromise=new Promise((t,i)=>{var e=document.createElement("script");e.src="https://www.youtube.com/iframe_api",e.async=!0,e.onload=a=>{YT.ready(t)},e.onerror=i,this.append(e)}))}async getYTPlayer(){return this.playerPromise||await this.activate(),this.playerPromise}async addYTPlayerIframe(){this.fetchYTPlayerApi(),await this.ytApiPromise;const t=document.createElement("div"),i='<div vidflow-el="instance-crop"><div vidflow-el="player-wrap"><div vidflow-el="player-crop"></div></div></div>';t.innerHTML=i,this.append(t);const e=Object.fromEntries(this.getParams().entries());this.playerPromise=new Promise(a=>{const o=t.querySelector('[vidflow-el="player-crop"]');let r=new YT.Player(o,{width:1920,height:1080,videoId:this.videoId,playerVars:e,events:{onReady:s=>{s.target.setPlaybackQuality("highres"),s.target.playVideo(),this.isMobile||this.showHideThumbnail(!1),a(r)},onStateChange:s=>{s.data===YT.PlayerState.PLAYING?this.showHideThumbnail(!1):s.data===YT.PlayerState.ENDED&&this.showHideThumbnail(!0)}}});this.player=r})}showHideThumbnail(t){this.querySelector('[vidflow-el="thumbnail"]').style.display=t?"flex":"none",this.querySelector('[vidflow-el="start"]').style.display=t?"flex":"none"}getParams(){const t=new URLSearchParams(this.getAttribute("params")||[]);return t.append("autoplay","1"),t.append("playsinline","1"),t.append("controls",0),t.append("rel",0),t.append("showinfo",0),t.append("modestbranding",1),t.append("ecver",2),t.append("vq","hd1080"),t}async activate(){if(!this.classList.contains("is-activated")&&(this.classList.add("is-activated"),this.needsYTApi))return this.addYTPlayerIframe(this.getParams())}}customElements.define("vidflow-player",VidflowEmbed),function(){if(window.location.hostname==="127.0.0.1"){const e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("href","http://127.0.0.1:5501/src/vidflow.css"),document.head.appendChild(e)}else{const e=document.createElement("style");e.innerHTML="{{REPLACE}}",document.head.appendChild(e)}function t(e){return e=e.split(/(vi\/|v=|\/v\/|youtu\.be\/|\/embed\/)/),e[2]!==void 0?e[2].split(/[^0-9a-z_\-]/i)[0]:e[0]}const i=document.querySelectorAll("[vidflow-el=player]");if(!i.length)throw new Error("No vidflow elements found.");i.forEach((e,a)=>{const o=e.getAttribute("vidflow-video"),r=e.nodeName==="IFRAME"?e:e.querySelector("iframe"),s=r?r.getAttribute("src"):o,l=t(s);let d=`https://i.ytimg.com/vi/${l}/hqdefault.jpg`;e.getAttribute("vidflow-thumbnail")&&(d=e.getAttribute("vidflow-thumbnail"));var n=document.createElement("div");n.setAttribute("vidflow-el","instance"),n.setAttribute("vidflow-state","loading"),e.parentNode.insertBefore(n,e),r&&n.appendChild(r),n.innerHTML=`<vidflow-player style="aspect-ratio: 16/9;" videoid="${l}" thumbnail="${d}"></vidflow-player>`,e.parentNode&&e.parentNode.removeChild(e)})}();
